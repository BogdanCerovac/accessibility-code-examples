# Success Criterion 2.4.7 - Focus Visible

## Android

On Android, you can change the background color on focus. To achieve this behavior, you can use a [ColorStateList](https://developer.android.com/guide/topics/resources/color-list-resource) and set it as background.

```xml
<!-- button_selector -->
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:drawable="@color/highlight" android:state_focused="true" />
    <item android:drawable="@color/primary" />
</selector>

<!-- layout -->
<Button
    android:id="@+id/button1"
    android:background="@drawable/button_selector">
</Button>
```

## iOS

On iOS, you can override the [accessibilityElementDidBecomeFocused](https://developer.apple.com/documentation/objectivec/nsobject/1615183-accessibilityelementdidbecomefoc) and [accessibilityElementDidLoseFocus](https://developer.apple.com/documentation/objectivec/nsobject/1615082-accessibilityelementdidlosefocus) methods. This makes it possible to change the background color at focus. Create a subclass for this.

```swift
class Button: UIButton {
    
    override open func accessibilityElementDidBecomeFocused() {
        backgroundColor = .primary
    }

    override open func accessibilityElementDidLoseFocus() {
        backgrounColor = .highlight
    }
}
```

## Flutter

With Flutter, you can change the background color on focus. This can be achieved by adding [ButtonStyle](https://api.flutter.dev/flutter/material/ButtonStyle-class.html) to a button and by implementing a method returning a value based on the [MaterialState](https://api.flutter.dev/flutter/material/MaterialState.html) of the button.

```dart
TextButton(
  style: ButtonStyle(
    backgroundColor: MaterialStateProperty.resolveWith(getColor),
  ),
  child: Text('Button'),
);

Color? getColor(Set<MaterialState> states) {
  const Set<MaterialState> interactiveStates = <MaterialState>{
    MaterialState.focused,
  };
  if (states.any(interactiveStates.contains)) {
    return Colors.blue;
  }
  return Colors.red;
}
```

## React Native

When a screen reader such as VoiceOver or TalkBack is used, the focused element receives the native focus border. 

Focus background colors can be changed, see [Focus Visible in Android](./../../Android/en/2.4.7.md) and [Focus Visible in iOS](./../../iOS/en/2.4.7.md) on how to make this possible.

## Xamarin

When a screen reader such as VoiceOver or TalkBack is used, the focused element receives a rectangular or circular focus border.

Unfortunately, is not possible to change the focus colors of assistive technologies on Android and iOS. But within the Xamarin Forms environment it is possible to change colors depending on state.

The Visual State Manager (VSM) provides a structured way to make visual changes to the user interface from code. In most cases, the user interface of the application is defined in XAML. This XAML includes markup describing how the VSM affects the visuals of the user interface.

The VSM defines one visual state group named "CommonStates" with the following visual states:

- Normal
- Disabled
- Focused
- Selected

This visual state group is supported for all classes that derive from VisualElement, which is the base class for View and Page. For more information, see [Visual State Manager](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/user-interface/visual-state-manager).

Example of changing the `BackgroundColor` based on the `VisualState`:

```csharp
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:VsmDemos"
             x:Class="VsmDemos.MainPage"
             Title="VSM Demos">

    <StackLayout>
        <StackLayout.Resources>
            <Style TargetType="Entry">
                <Setter Property="Margin" Value="20, 0" />
                <Setter Property="FontSize" Value="18" />
            </Style>

            <Style TargetType="Label">
                <Setter Property="Margin" Value="20, 30, 20, 0" />
                <Setter Property="FontSize" Value="Large" />
            </Style>
        </StackLayout.Resources>

        <Label Text="Normal Entry:" />
        <Entry />
        <Label Text="Entry with VSM: " />
        <Entry>
            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup x:Name="CommonStates">
                    <VisualState x:Name="Normal">
                        <VisualState.Setters>
                            <Setter Property="BackgroundColor" Value="Lime" />
                        </VisualState.Setters>
                    </VisualState>
                    <VisualState x:Name="Focused">
                        <VisualState.Setters>
                            <Setter Property="FontSize" Value="36" />
                        </VisualState.Setters>
                    </VisualState>
                    <VisualState x:Name="Disabled">
                        <VisualState.Setters>
                            <Setter Property="BackgroundColor" Value="Pink" />
                        </VisualState.Setters>
                    </VisualState>
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>

            <Entry.Triggers>
                <DataTrigger TargetType="Entry"
                             Binding="{Binding Source={x:Reference entry3},
                                               Path=Text.Length}"
                             Value="0">
                    <Setter Property="IsEnabled" Value="False" />
                </DataTrigger>
            </Entry.Triggers>
        </Entry>
        <Label Text="Entry to enable 2nd Entry:" />
        <Entry x:Name="entry3"
               Text=""
               Placeholder="Type something to enable 2nd Entry" />
    </StackLayout>
</ContentPage>
```

It's often necessary to share the same VSM markup among two or more views. In this case, you should place the markup in a `Style` definition:

```xml
<Style TargetType="Entry">
    <Setter Property="Margin" Value="20, 0" />
    <Setter Property="FontSize" Value="18" />
    <Setter Property="VisualStateManager.VisualStateGroups">
        <VisualStateGroupList>
            <VisualStateGroup x:Name="CommonStates">
                <VisualState x:Name="Normal">
                    <VisualState.Setters>
                        <Setter Property="BackgroundColor" Value="Lime" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="Focused">
                    <VisualState.Setters>
                        <Setter Property="FontSize" Value="36" />
                        <Setter Property="BackgroundColor" Value="Lime" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="Disabled">
                    <VisualState.Setters>
                        <Setter Property="BackgroundColor" Value="Pink" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateGroupList>
    </Setter>
</Style>
```
